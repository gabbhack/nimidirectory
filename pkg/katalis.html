<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nim Package Directory</title>
  <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="New and updated Nim packages" href="https://nimble.directory/packages.xml">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlite.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script type="text/javascript" src="/js/app.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container">
    <a href="/" class="logo fw-500 display-1 text-black text-decoration-none navbar-brand"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a href="https://nim-lang.org/" class="nav-link">What's Nim?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="/about.html" class="nav-link">What's Nimble?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="https://github.com/nim-lang/packages/" class="nav-link">Publish your package</a>
        </li>
        <!-- TODO: replace with something different -->
        <li class="nav-item ms-3">
          <a class="nav-link" href="https://www.youtube.com/channel/UCDAYn_VFt0VisL5-1a5Dk7Q/">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          </a>
        </li>
        <li class="nav-item ms-3">
          <a class="nav-link theme-switcher-btn" id="darkmode" onclick="toggle_dark_mode()" href="#">
            <span id="light-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </span>
            <span id="dark-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content">
  <div class="container">
    <div class="container pt-10">
        <h3 class="mb-3 fw-bold display-6 pt-4">katalis</h3>
        <p class="tags">
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">web</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">framework</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">http</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">util</button></a>
                </span>
            
        </p>
        
            <p class="pkg-desc">Katalis is nim lang micro web framework</p>
        
        <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');"
            alt="Copy on clipboard">
            <i class="fa fa-copy"></i>
        </a>
        <input id="cmd" onclick="this.select();" value="nimble install katalis" readonly="">
        <br>
        <small style="font-size: 0.8rem;">Need help? Read <a
                href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small>
    </div>

    <div class="container row pt-4" id="pkg-content">
        <div class="col-8 box rounded p-3" id="readme-section">
            
                <document><h1>Gold Sponsor</h1>
<table>
  <tr>
    <td>
    <a href="https://amscloud.co.id">  <img src="https://github.com/zendbit/katalis-readme-assets/blob/f146951204bb7f941412d9becc8fa64c6cf7f5e0/Banner_Awan%20Media%20Semesta_600_BG.png" style="max-width: 100%;" height="100px" /></a>
    <a href="https://superserver.co.id">  <img src="https://github.com/zendbit/katalis-readme-assets/blob/f146951204bb7f941412d9becc8fa64c6cf7f5e0/Banner_Super%20Server_600%20(1)_BG.png" style="max-width: 100%;" height="100px" /></a>
    <br />
    <a href="https://wisatech.co.id">  <img src="https://github.com/zendbit/katalis-readme-assets/blob/68132bf0ae335fd61c071d9bfb7f42483be3873a/WhatsApp%20Image%202024-11-10%20at%2000.58.36.jpeg" style="max-width: 100%;" height="100px" /></a>   
    </td>
    <td>
    <a href="https://www.facebook.com/kandangretawu">  <img src="https://github.com/zendbit/katalis-readme-assets/blob/02ca1a457bba7d678d554cf5e931742ed8a955e1/326268483_1219408249008756_5424435258872438740_n.png" style="max-width: 100%;" height="200px" /></a>
    </td>
  </tr>
</table>
<h1>Katalis</h1>
<p>Katalis is <a href="https://nim-lang.org">nim lang</a> micro web framework</p>
<p>Katalis always focusing on protocol implementation and performance improvement. For fullstack framework using katalis it will be depends on developer needs, we will not provides frontend engine or database layer engine (ORM) because it will vary for each developer taste!.</p>
<p>If you want to use katalis as fullstack nim, you can read on fullstack section in this documentation.</p>
<h2>1. Install</h2>
<pre>  <code class="language-bash">nimble install katalis
</code></pre>
<p>If some reason failed to install using nimble directory, you can install directly from the github</p>
<pre>  <code class="language-bash">nimble install https://github.com/zendbit/katalis
</code></pre>
<h2>2. Running simple app</h2>
<p>After installing katalis, you can simply create your first app by import <em>katalisApp</em></p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">katalis</span><span class="op">/</span><span class="ide">katalisApp</span></div></div>  </code></pre>
<p>Katalis has some macros for it&apos;s own DSL. Katalis use <em>@!</em> as macros prefix (We will explore about katalis DSL on the next section).</p>
<p>Create directory for the app</p>
<pre>  <code class="language-bash">mkdir simpleapp
cd simpleapp
</code></pre>
<p>Create nim source file, in this case we will use <em>app.nim</em></p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">katalis</span><span class="op">/</span><span class="ide">katalisApp</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com">## lets do some basics configuration</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableServeStatic</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableKeepAlive</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"><span class="com">## we also can use custom port</span></div></div><div class="line"><div class="line-content"><span class="com">#@!Settings.port = Port(8080)</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com">## lets start simple app</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="str">&quot;&lt;h1&gt;Hello World!.&lt;/h1&gt;&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com">## kick and start the app</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Emit</span></div></div>  </code></pre>
<p>Compile the source with --threads:on switch to enable thread support and run it!</p>
<pre>  <code class="language-bash">nim c -r --threads:on app.nim
</code></pre>
<p>Katalis will run on port 8000 as default port</p>
<pre>  <code class="language-bash">Listening non secure (plain) on http://0.0.0.0:8000
</code></pre>
<p>Lets open with the browser <a href="http://localhost:8000">http://localhost:8000</a></p>
<p><img src="https://github.com/zendbit/katalis-readme-assets/blob/981946bf0fee5acaa341edc04ed3e26f82263e5c/Screenshot%20From%202024-11-03%2021-38-44.png" style="max-width: 100%;" alt="Alt http://localhost:8000" />--threads:on</p>
<h2>3. Katalis structure</h2>
<p>Internal katalis structure is devided into some folders structure</p>
<h3>3.1 core (folder)</h3>
<p>Core folder contains base katalis framework it&apos;s focused on http protocol implementataion and some protocols enhancements
|Filename|Description|
|--------|-----------|
|constants.nim|contains constans declaration used by katalis|
|environment.nim|contains shared environment (settings, shared threads variable)|
|form.nim|contains functionalities for construct form (urlencoded, data)|
|httpContext.nim|contains http context per client request (cookie, request, response)|
|katalis.nim|katalis object type and instance|
|multipart.nim|contains functionality for construct multipart data|
|replyMsg.nim|universal response message to client|
|request.nim|request object type used by http context|
|response.nim|response object type used by http context|
|routes.nim|route object type and instance, contains funtionalities for handling route request|
|session.nim|contains funtionalities for handling cookies|
|staticFile.nim|contains funtionalities for handling static file|
|webSocket.nim|websocket object type for handling websocket request|</p>
<h3>3.2 Pipelines (folder)</h3>
<p>Pipelines in katalis is like middleware, it will process request from client and response with appropriate response. Katalis has some pipelines
|Pipelines|Descriptions|
|---------|------------|
|after|this will be evaluate after route process|
|before|this will be evaluate before route process|
|initialize|will be eveluate on katalis initialization when katalis start|
|onReply|will be evaluate before response message to client, this usually used for modified response message|</p>
<h4>3.2.1 Initialize pipelines</h4>
<p>Initialize pipeline will be eveluate on katalis initialization when katalis start.
|Filename|Description|
|--------|-----------|
|taskMonitor.nim|this will start task monitor for katalis|</p>
<p>We can also add custom task with schedules like cron job</p>
<h4>3.2.2 Before pipelines</h4>
<p>Before pipeline will be evaluate before route processing, this pipeline has advantages like early checking like authentication. Katalis has some predefines before pipelines
|Filename|Description|
|--------|-----------|
|http.nim|handle http request from client (get, post, head, etc)|
|httpRanges.nim|handle http ranges request from client|
|session.nim|session initialization|
|webSocket.nim|handle web socket request from client, if http protocol upgrade request present|</p>
<h4>3.2.3 After pipelines</h4>
<p>After pipeline will be evaluate after route processing, this pipelines has advantages like early checking if request has access to route resource or not
|Filename|Description|
|--------|-----------|
|httpStaticFile.nim|handle static file request from client|</p>
<p>Static file must be placed is in <em>static</em> folder, but we can also changes default static folder from configuration (For more information about configuration see configuration section).</p>
<h4>3.2.4 OnReply pipelines</h4>
<p>OnReply pipeline will be evaluate before sending response to client, this pipeline used for modifying payload.
|Filename|Description|
|--------|-----------|
|httpChunked.nim|handle chunked payload response, default is chunked as http standard|
|httpComposePayload.nim|handle composing payload header + body for response|
|httpCompress.nim|handle compression support (gzip) if client support zip compression|</p>
<h4>3.2.5 Cleanup pipelines</h4>
<p>Clenup pipeline will evaluate after sending response to client, this pipeline will evaluate after all process response to client finished.
|Filename|Description|
|--------|-----------|
|httpContext.nim|will cleanup unused cache data related with http context|</p>
<h3>3.3 Macros (folder)</h3>
<p>Macros folder contains macros definition for katalis framework
|Filename|Description|
|--------|-----------|
|sugar.nim|macros definition for katalis DSL (Domain Specific Language)|</p>
<p>More information about DSL, see DSL (Domain Specific Languate) section</p>
<h3>3.4 Utils (folder)</h3>
<p>Utilities and helper for katalis framework
|Filename|Description|
|--------|-----------|
|crypt.nim|some cryptohraphy algorithm|
|debug.nim|debug msg|
|httpcore.nim|http core stdlib extension|
|json.nim|some json stdlib extension|</p>
<h3>3.5 Extension (folder)</h3>
<p>Internal extension for katalis framework
|Filename|Description|
|--------|-----------|
|mustache.nim|mustache template engine using <a href="https://github.com/fenekku/moustachu">mustachu</a> nimble pkg|
|taskMonitor.nim|simple cron job for katalis|
|validation.nim|simplify validation for form, json, and Table[string, string]|</p>
<h3>3.6 KatalisApp (file)</h3>
<p>Katalis application, this is starting poin of katalis framework. Includes all file needed for developing katalis application.
|Filename|Description|
|--------|-----------|
|katalisApp.nim|include this file for starting the app server|</p>
<h3>3.7 Pipelines (file)</h3>
<p>Katalis pipeline contains include declaration for katalis pipelines order, include declaration is important depend on this order:</p>
<ul>
<li>initialize</li>
<li>before</li>
<li>after</li>
<li>onReply</li>
<li>cleanup</li>
</ul>
<table>
<thead>
<tr>
<th>Filename</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>pipelines.nim</td>
<td>pipeline order includes declaration</td>
</tr></tbody></table>
<h2>4. Katalis DSL (Domain Specific Language)</h2>
<p>Katalis come with Domain Specific Language, the purpose using DSL is for simplify the development and write less code. Katalis using <em>@!</em> prefix for the DSL to prevent confict and make it easy for coding convention. Katalis DSL available in <em>katalis/macros/sugar.nim</em>. There are some macros that only can be called inside <em>@!App</em> block and block pipeline in katalis let see the table.</p>
<p>Available on outside <em>@!App</em> block
|Name|Description|
|----|-----------|
|@!Settings|katalis settings instance, related to Settings type object in katalis/core/environment.nim|
|@!Emit|start katalis app, related to Katalis type object in katalis/core/katalis.nim|
|@!Routes|katalis routes object instance, related to Route type object in katalis/core/routes.nim|
|@!Katalis|katalis object instance, related to Katalis type object in katalis/core/katalis.nim|
|@!Environment|katalis environment instance, related to Environment type object in katalis/core/environment.nim|
|@!SharedEnv|katalis shared Table[string, string] type object for sharing between the app instance, related to Environment type object in katalis/core/environment.nim|
|@!Trace|trace block for displaying debug message, available when @!Settings.enableTrace = true|</p>
<p>Available only inside <em>@!App</em> block
|Name|Description|
|----|-----------|
|@!Before|before route block pipeline|
|@!After|after route block pipeline|
|@!OnReply|on reply pipeline|
|@!Cleanup|cleanup pipeline|
|@!EndPoint|set endpoint for each route prefix (Optional)|
|@![Get, Post, Patch, Delete, Put, Options, Trace, Head, Connect]|http method for routing|
|@!Context|http context route parameter, related to HttpContext type object in katalis/core/httpContext.nim|
|@!Env|environment route parameter, related to Environment type object in katalis/core/environment.nim|
|@!Req|request context from client, related to Request type object in katalis/core/request.nim|
|@!Res|response context to client, related to Response type object in katalis/core/response.nim|
|@!WebSocket|websocket context service, related to WebSocket type object in katalis/core/webSocket.nim|
|@!Client|socket client context, related to AsyncSocket type object in katalis/core/httpContext.nim|
|@!Body|request body from client, related to Request type object field in katalis/core/request.nim|
|@!Segment|path segment url from client request, related to RequestParam type object in katalis/core/request.nim also related to Table[string, string] nim stdlib|
|@!Query|query string from client request, related to RequestParam type object in katalis/core/request.nim also related to Table[string, string] nim stdlib|
|@!Json|json data from client request, related to RequestParam type object in katalis/core/request.nim also related to JsonNode nim stdlib|
|@!Xml|xml data from client request, related to RequestParam type object in katalis/core/request.nim also related to XmlNode nim stdlib|
|@!Form|form data from client will handle form urlencode/multipart, related to Form type object in katalis/core/form.nim|</p>
<p>DSL Code structure in Katalis</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com">## available on global</span></div></div><div class="line"><div class="line-content"><span class="com">## @!Settings</span></div></div><div class="line"><div class="line-content"><span class="com">## @!Emit -&gt; Should called after @!App block</span></div></div><div class="line"><div class="line-content"><span class="com">## @!Route</span></div></div><div class="line"><div class="line-content"><span class="com">## @!Katalis</span></div></div><div class="line"><div class="line-content"><span class="com">## @!Environment</span></div></div><div class="line"><div class="line-content"><span class="com">## @!SharedEnv</span></div></div><div class="line"><div class="line-content"><span class="com">## @!Trace</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com">## katalis app block</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="com">## code here</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## endpoint optional, this endpoint prefix path will append to each route path request</span></div></div><div class="line"><div class="line-content">  <span class="com">## this is optional, and should be define before all other pipeline</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">EndPoint</span> <span class="str">&quot;/test/api&quot;</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## before route block</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Before</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## available here</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Context</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Req</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Res</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Env</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Res</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!WebSocket</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Client</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Body</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Segment</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Query</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Json</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Xml</span></div></div><div class="line"><div class="line-content">    <span class="com">## @!Form</span></div></div><div class="line"><div class="line-content">    <span class="com">## also global katalis macros</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## code here</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## after route block</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">After</span>:</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## code here</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## on reply block</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">OnReply</span>:</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## code here</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## cleanup block</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Cleanup</span>:</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## code here</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## routing</span></div></div><div class="line"><div class="line-content">  <span class="com">## available method @!Get, @!Post, @!Put, @!Delete, @!Patch, @!Head, @!Connect, @!Options, @!Trace</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Post</span> <span class="str">&quot;/register&quot;</span>:</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## code here</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/home&quot;</span>:</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## code here</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## also support for multiple method on routing</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span>[<span class="ide">Get</span>, <span class="ide">Post</span>] <span class="str">&quot;/login&quot;</span>:</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## code here</span></div></div>  </code></pre>
<h2>5. Configuration</h2>
<p>Configuration can be set using <em>@!Settings</em> macro. See katalis/core/environment.nim (Settings object type)</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">address</span> <span class="op">=</span> <span class="str">&quot;0.0.0.0&quot;</span> <span class="com">## default</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">port</span> <span class="op">=</span> <span class="ide">Port</span>(<span class="num">8000</span>) <span class="com">## default</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com">## available settings (default value, all size metric in bytes):</span></div></div><div class="line"><div class="line-content"><span class="com">## address: string = &quot;0.0.0.0&quot;</span></div></div><div class="line"><div class="line-content"><span class="com">## port: Port = Port(8000)</span></div></div><div class="line"><div class="line-content"><span class="com">## enableReuseAddress: bool = true</span></div></div><div class="line"><div class="line-content"><span class="com">## enableReusePort:bool = true</span></div></div><div class="line"><div class="line-content"><span class="com">## sslSettings: SslSettings = nil</span></div></div><div class="line"><div class="line-content"><span class="com">## maxRecvSize: int64 = 209715200</span></div></div><div class="line"><div class="line-content"><span class="com">## enableKeepAlive: bool = true</span></div></div><div class="line"><div class="line-content"><span class="com">## enableOOBInline: bool = false</span></div></div><div class="line"><div class="line-content"><span class="com">## enableBroadcast: bool = false</span></div></div><div class="line"><div class="line-content"><span class="com">## enableDontRoute: bool = false</span></div></div><div class="line"><div class="line-content"><span class="com">## storagesDir: string = getCurrentDir()/&quot;storages&quot;.Path</span></div></div><div class="line"><div class="line-content"><span class="com">## storagesUploadDir: string = getCurrentDir()/&quot;storages&quot;.Path/&quot;upload&quot;.Path</span></div></div><div class="line"><div class="line-content"><span class="com">## storagesBodyDir: string = getCurrentDir()/&quot;storages&quot;.Path/&quot;body&quot;.Path</span></div></div><div class="line"><div class="line-content"><span class="com">## storagesSessionDir: string = getCurrentDir()/&quot;storages&quot;.Path/&quot;session&quot;.Path</span></div></div><div class="line"><div class="line-content"><span class="com">## staticDir: string = getCurrentDir()/&quot;static&quot;.Path</span></div></div><div class="line"><div class="line-content"><span class="com">## enableServeStatic: bool = false</span></div></div><div class="line"><div class="line-content"><span class="com">## readRecvBuffer: int = 524288</span></div></div><div class="line"><div class="line-content"><span class="com">## enableTrace: bool = false</span></div></div><div class="line"><div class="line-content"><span class="com">## chunkSize: int = 16384</span></div></div><div class="line"><div class="line-content"><span class="com">## maxSendSize: int = 52428800</span></div></div><div class="line"><div class="line-content"><span class="com">## enableChunkedTransfer: bool = true</span></div></div><div class="line"><div class="line-content"><span class="com">## enableRanges: bool = true</span></div></div><div class="line"><div class="line-content"><span class="com">## rangesSize: int = 2097152</span></div></div><div class="line"><div class="line-content"><span class="com">## enableCompression: bool = true</span></div></div><div class="line"><div class="line-content"><span class="com">## maxBodySize: int = 52428800</span></div></div>  </code></pre>
<h2>6. Serve static file</h2>
<p>For serving static file like static html, css, image, video, etc. We only need to enable <em>enableServeStatic</em> in katalis settings.</p>
<p>Lets create <em>serverstatic-example</em> folder.</p>
<pre>  <code class="language-bash">mkdir servestatic-example
cd servestatic-example
</code></pre>
<p>Then create <em>static</em> folder inside <em>servestatic-example</em> folder</p>
<pre>  <code class="language-bash">mkdir static
</code></pre>
<p>Inside <em>servestatic-example</em> folder we create minimal katalis app for serving static file. In this case we create <em>app.nim</em></p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">katalis</span><span class="op">/</span><span class="ide">katalisApp</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com">## enable static file service</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableServeStatic</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableKeepAlive</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Emit</span></div></div>  </code></pre>
<p>Compile and start the server</p>
<pre>  <code class="language-bash">nim c -r app.nim
</code></pre>
<p>Don&apos;t forget to put your static files into <em>static</em> folder</p>
<p>  <img src="https://github.com/zendbit/katalis-readme-assets/blob/94adfbcf3d80eb3eaec2d60974203b7c1737382a/Screenshot%20From%202024-11-09%2016-09-16.png" style="max-width: 100%;" alt="Alt static folders" /></p>
<p>Open with browser <a href="http://localhost:8000/index.html">http://localhost:8000/index.html</a></p>
<h2>7. Create routes and handling request</h2>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">katalis</span><span class="op">/</span><span class="ide">katalisApp</span></div></div><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">katalis</span><span class="op">/</span><span class="ide">extension</span><span class="op">/</span><span class="ide">mustache</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableServeStatic</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableKeepAlive</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="com">## we can also create prefix for all routes</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">EndPoint</span> <span class="str">&quot;/admin&quot;</span> <span class="com">## \</span></div></div><div class="line"><div class="line-content">  <span class="com">## all routes will prefixed with /admin/</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## get request for default /</span></div></div><div class="line"><div class="line-content">  <span class="com">## in this case, because we already set @!EndPoint to &quot;/admin&quot;</span></div></div><div class="line"><div class="line-content">  <span class="com">## so the route url will be http://localhost:8000/admin</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="str">&quot;&lt;h1&gt;This is admin the root page!&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## another get example</span></div></div><div class="line"><div class="line-content">  <span class="com">## http://localhost:8000/hello</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/hello&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="str">&quot;&lt;h1&gt;world!&lt;/h1&gt;&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## mapping route, retrieve segment to variable</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/birthdate/:month/:day/:year&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## this will retrieve segments</span></div></div><div class="line"><div class="line-content">    <span class="com">## as variable month, day, and year</span></div></div><div class="line"><div class="line-content">    <span class="com">## http://localhost/admin/birthdate/may/22/2000</span></div></div><div class="line"><div class="line-content">    </div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">birthdate</span> <span class="op">=</span> [<span class="op">@!</span><span class="ide">Segment</span>[<span class="str">&quot;month&quot;</span>],  <span class="op">@!</span><span class="ide">Segment</span>[<span class="str">&quot;day&quot;</span>], <span class="op">@!</span><span class="ide">Segment</span>[<span class="str">&quot;year&quot;</span>]]<span class="op">.</span><span class="ide">join</span>(<span class="str">&quot;/&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(</div></div><div class="line"><div class="line-content">      <span class="ide">Http200</span>,</div></div><div class="line"><div class="line-content">      <span class="op">&amp;</span><span class="str">&quot;&lt;h3&gt;Birthdate&lt;/h3&gt; &lt;p&gt;{birthdate}&lt;/p&gt;&quot;</span></div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## mapping route, retrieve query string to variable</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/birthdate&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## this will retrieve query string</span></div></div><div class="line"><div class="line-content">    <span class="com">## as variable month, day, and year</span></div></div><div class="line"><div class="line-content">    <span class="com">## http://localhost/admin/birthdate?month=may&amp;day=22&amp;year=2000</span></div></div><div class="line"><div class="line-content">    </div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">birthdate</span> <span class="op">=</span> [<span class="op">@!</span><span class="ide">Query</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;month&quot;</span>),  <span class="op">@!</span><span class="ide">Query</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;day&quot;</span>), <span class="op">@!</span><span class="ide">Query</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;year&quot;</span>)]<span class="op">.</span><span class="ide">join</span>(<span class="str">&quot;/&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(</div></div><div class="line"><div class="line-content">      <span class="ide">Http200</span>,</div></div><div class="line"><div class="line-content">      <span class="op">&amp;</span><span class="str">&quot;&lt;h3&gt;Birthdate&lt;/h3&gt; &lt;p&gt;{birthdate}&lt;/p&gt;&quot;</span></div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## mapping route, retrieve segment as regex pattern</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/birthdate/re&lt;:month([a-zA-Z]+)_:day([0-9]+)_:year([0-9]+)&gt;&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## this will retrieve query string</span></div></div><div class="line"><div class="line-content">    <span class="com">## as variable month, day, and year</span></div></div><div class="line"><div class="line-content">    <span class="com">## http://localhost/admin/birthdate/may_22_2000</span></div></div><div class="line"><div class="line-content">    </div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">birthdate</span> <span class="op">=</span> [<span class="op">@!</span><span class="ide">Segment</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;month&quot;</span>),  <span class="op">@!</span><span class="ide">Segment</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;day&quot;</span>), <span class="op">@!</span><span class="ide">Segment</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;year&quot;</span>)]<span class="op">.</span><span class="ide">join</span>(<span class="str">&quot;/&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(</div></div><div class="line"><div class="line-content">      <span class="ide">Http200</span>,</div></div><div class="line"><div class="line-content">      <span class="op">&amp;</span><span class="str">&quot;&lt;h3&gt;Birthdate&lt;/h3&gt; &lt;p&gt;{birthdate}&lt;/p&gt;&quot;</span></div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## we also can have multiple method</span></div></div><div class="line"><div class="line-content">  <span class="com">## in one route definition</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span>[<span class="ide">Get</span>, <span class="ide">Post</span>] <span class="str">&quot;/login&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## we can use validation to check fields</span></div></div><div class="line"><div class="line-content">    <span class="com">## but for validation details we will discuss in other section</span></div></div><div class="line"><div class="line-content">    <span class="com">## about validation</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## let get form data username, password</span></div></div><div class="line"><div class="line-content">    <span class="com">## if method http post validate the form data</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">username</span> <span class="op">=</span> <span class="op">@!</span><span class="ide">Form</span><span class="op">.</span><span class="ide">data</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;username&quot;</span>)</div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">password</span> <span class="op">=</span> <span class="op">@!</span><span class="ide">Form</span><span class="op">.</span><span class="ide">data</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;password&quot;</span>)</div></div><div class="line"><div class="line-content">    <span class="kwd">var</span> <span class="ide">errorMsg</span> <span class="op">=</span> <span class="str">&quot;&quot;</span></div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="op">@!</span><span class="ide">Req</span><span class="op">.</span><span class="ide">httpMethod</span> <span class="op">==</span> <span class="ide">HttpPost</span>:</div></div><div class="line"><div class="line-content">      <span class="kwd">if</span> <span class="ide">username</span> <span class="op">==</span> <span class="str">&quot;&quot;</span> <span class="kwd">or</span> <span class="ide">password</span> <span class="op">==</span> <span class="str">&quot;&quot;</span>:</div></div><div class="line"><div class="line-content">        <span class="ide">errorMsg</span> <span class="op">=</span> <span class="str">&quot;username or password is required!&quot;</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">##</span></div></div><div class="line"><div class="line-content">    <span class="com">## katalis come with mustache template engine</span></div></div><div class="line"><div class="line-content">    <span class="com">## for template engine we will explain later</span></div></div><div class="line"><div class="line-content">    <span class="com">##</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">tpl</span> <span class="op">=</span> </div></div><div class="line"><div class="line-content">      """
        <html>
          <head>
            <title>example</title>
          </head>
          <body>
            <h3>Login</h3>
            <form method="POST">
              <input type="text" name="username" placeholder="username" value="{{username}}">
              <br>
              <input type="password" name="password" placeholder="password" value="{{password}}">
              <br>
              <input type="submit" value="Login">
            </form>
            <h4>{{errorMsg}}</h4>
          </body>
        </html>
      """</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">m</span> <span class="op">=</span> <span class="ide">newMustache</span>()</div></div><div class="line"><div class="line-content">    <span class="ide">m</span><span class="op">.</span><span class="ide">context</span>[<span class="str">&quot;errorMsg&quot;</span>] <span class="op">=</span> <span class="ide">errorMsg</span></div></div><div class="line"><div class="line-content">    <span class="ide">m</span><span class="op">.</span><span class="ide">context</span>[<span class="str">&quot;username&quot;</span>] <span class="op">=</span> <span class="ide">username</span></div></div><div class="line"><div class="line-content">    <span class="ide">m</span><span class="op">.</span><span class="ide">context</span>[<span class="str">&quot;password&quot;</span>] <span class="op">=</span> <span class="ide">password</span></div></div><div class="line"><div class="line-content">    <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="ide">m</span><span class="op">.</span><span class="ide">render</span>(<span class="ide">tpl</span>))</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com">## we can have multiple @!App for routes separation</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="com">## let definde endpoint for users</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">EndPoint</span> <span class="str">&quot;/user&quot;</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com">## the user root page</span></div></div><div class="line"><div class="line-content">  <span class="com">## http://localhost:8000/user</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="str">&quot;&lt;h1&gt;This is user root page&lt;/h1&gt;&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Emit</span></div></div>  </code></pre>
<h2>8. Query string, form (urlencoded/multipart), json, xml, upload, Redirect, Session</h2>
<h3>8.1 Handling query string request</h3>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">katalis</span><span class="op">/</span><span class="ide">katalisApp</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableServeStatic</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableKeepAlive</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/test-qs&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## lets do query string test</span></div></div><div class="line"><div class="line-content">    <span class="com">## http://localhost:8000/test-qs?city=ngawi&amp;province=surabaya with get method</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">city</span> <span class="op">=</span> <span class="op">@!</span><span class="ide">Query</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;city&quot;</span>)</div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">province</span> <span class="op">=</span> <span class="op">@!</span><span class="ide">Query</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;province&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="op">&amp;</span><span class="str">&quot;&lt;h3&gt;Welcome to {province}, {city}.&lt;/h3&gt;&quot;</span>)</div></div>  </code></pre>
<h3>8.2 Handling form data</h3>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">katalis</span><span class="op">/</span><span class="ide">katalisApp</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableServeStatic</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableKeepAlive</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Post</span> <span class="str">&quot;/test-form&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## lets do form test</span></div></div><div class="line"><div class="line-content">    <span class="com">## http://localhost:8000/test-form with post method</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">city</span> <span class="op">=</span> <span class="op">@!</span><span class="ide">Form</span><span class="op">.</span><span class="ide">data</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;city&quot;</span>)</div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">province</span> <span class="op">=</span> <span class="op">@!</span><span class="ide">Form</span><span class="op">.</span><span class="ide">data</span><span class="op">.</span><span class="ide">getOrDefault</span>(<span class="str">&quot;province&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="op">&amp;</span><span class="str">&quot;&lt;h3&gt;Welcome to {province}, {city}.&lt;/h3&gt;&quot;</span>)</div></div>  </code></pre>
<h3>8.3 Handling JSON data</h3>
<p>All json request data will convert to nim stdlib json see <a href="https://nim-lang.org/docs/json.html">https://nim-lang.org/docs/json.html</a></p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">katalis</span><span class="op">/</span><span class="ide">katalisApp</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableServeStatic</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableKeepAlive</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Post</span> <span class="str">&quot;/test-json&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## lets do json test</span></div></div><div class="line"><div class="line-content">    <span class="com">## http://localhost:8000/test-json with post method</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">data</span> <span class="op">=</span> <span class="op">@!</span><span class="ide">Json</span> <span class="com">## \</span></div></div><div class="line"><div class="line-content">    <span class="com">## json data from client request</span></div></div><div class="line"><div class="line-content">    <span class="com">## all data will convert to nim stdlib JsonNode</span></div></div><div class="line"><div class="line-content">    <span class="com">## see https://nim-lang.org/docs/json.html</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## lets modify the data add country to json</span></div></div><div class="line"><div class="line-content">    <span class="ide">data</span>[<span class="str">&quot;country&quot;</span>] <span class="op">=</span> <span class="op">%</span><span class="str">&quot;indonesia&quot;</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## katalis will automatic response as json if we pass JsonNode</span></div></div><div class="line"><div class="line-content">    <span class="com">## lets pass JsonNode from client and we modify it</span></div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">replyJson</span>(<span class="ide">Http200</span>, <span class="ide">data</span>)</div></div>  </code></pre>
<h3>8.4 Handling XML data</h3>
<p>All xml request data will convert to nim stdlib xmltree see <a href="https://nim-lang.org/docs/xmltree.html">https://nim-lang.org/docs/xmltree.html</a></p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Post</span> <span class="str">&quot;/test-xml&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## lets do xml test</span></div></div><div class="line"><div class="line-content">    <span class="com">## http://localhost:8000/test-xml with post method</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">data</span> <span class="op">=</span> <span class="op">@!</span><span class="ide">Xml</span> <span class="com">## \</span></div></div><div class="line"><div class="line-content">    <span class="com">## xml data from client request</span></div></div><div class="line"><div class="line-content">    <span class="com">## all data will convert to nim stdlib XmlNode</span></div></div><div class="line"><div class="line-content">    <span class="com">## see https://nim-lang.org/docs/xmltree.html</span></div></div><div class="line"><div class="line-content">    <span class="com">##</span></div></div><div class="line"><div class="line-content">    <span class="com">## Try to send data using this xml format</span></div></div><div class="line"><div class="line-content">    <span class="com">##  &lt;Address&gt;</span></div></div><div class="line"><div class="line-content">    <span class="com">##    &lt;City&gt;Ngawi&lt;/City&gt;</span></div></div><div class="line"><div class="line-content">    <span class="com">##    &lt;Province&gt;Surabaya&lt;/Province&gt;</span></div></div><div class="line"><div class="line-content">    <span class="com">##  &lt;/Address&gt;</span></div></div><div class="line"><div class="line-content">    <span class="com">##</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## lets modify the data add country</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">country</span> <span class="op">=</span> <span class="ide">newElement</span>(<span class="str">&quot;Country&quot;</span>)</div></div><div class="line"><div class="line-content">    <span class="ide">country</span><span class="op">.</span><span class="ide">add</span>(<span class="ide">newText</span>(<span class="str">&quot;Indonesia&quot;</span>))</div></div><div class="line"><div class="line-content">    <span class="ide">data</span><span class="op">.</span><span class="ide">add</span>(<span class="ide">country</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## katalis will automatic response as xml if we pass XmlNode</span></div></div><div class="line"><div class="line-content">    <span class="com">## lets pass XmlNode from client and we modify it</span></div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">replyXml</span>(<span class="ide">Http200</span>, <span class="ide">data</span>)</div></div>  </code></pre>
<h3>8.5 Handling uploaded files</h3>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span>[<span class="ide">Get</span>, <span class="ide">Post</span>] <span class="str">&quot;/test-upload&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## lets do upload multipart data</span></div></div><div class="line"><div class="line-content">    <span class="com">## katalis come with mustache template engine</span></div></div><div class="line"><div class="line-content">    <span class="com">## for template engine we will explain later</span></div></div><div class="line"><div class="line-content">    <span class="com">##</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">tpl</span> <span class="op">=</span> </div></div><div class="line"><div class="line-content">      """
        <html>
          <head>
            <title>upload test</title>
          </head>
          <body>
            <h3>Upload files</h3>
            <form method="POST" enctype="multipart/form-data">
              Upload Single
              <br>
              <input name="onefile" type="file" />
              <br>
              <br>
              Upload Multiple
              <br>
              <input name="multiplefiles[]" type="file" multiple />
              <br>
              <br>
              <button type="submit">Upload</button>
            </form>
          </body>
        </html>
      """</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="op">@!</span><span class="ide">Req</span><span class="op">.</span><span class="ide">httpMethod</span> <span class="op">==</span> <span class="ide">HttpPost</span>:</div></div><div class="line"><div class="line-content">      <span class="com">## test show uploaded file info to console</span></div></div><div class="line"><div class="line-content">      <span class="kwd">if</span> <span class="op">@!</span><span class="ide">Form</span><span class="op">.</span><span class="ide">files</span><span class="op">.</span><span class="ide">len</span> <span class="op">!=</span> <span class="num">0</span>:</div></div><div class="line"><div class="line-content">        <span class="kwd">for</span> <span class="ide">name</span>, <span class="ide">files</span> <span class="kwd">in</span> <span class="op">@!</span><span class="ide">Form</span><span class="op">.</span><span class="ide">files</span>:</div></div><div class="line"><div class="line-content">          <span class="ide">echo</span> <span class="ide">name</span></div></div><div class="line"><div class="line-content">          <span class="kwd">for</span> <span class="ide">file</span> <span class="kwd">in</span> <span class="ide">files</span>:</div></div><div class="line"><div class="line-content">            <span class="ide">echo</span> <span class="ide">file</span><span class="op">.</span><span class="ide">extension</span></div></div><div class="line"><div class="line-content">            <span class="ide">echo</span> <span class="ide">file</span><span class="op">.</span><span class="ide">path</span></div></div><div class="line"><div class="line-content">            <span class="ide">echo</span> <span class="ide">file</span><span class="op">.</span><span class="ide">mimetype</span></div></div><div class="line"><div class="line-content">            <span class="ide">echo</span> <span class="ide">file</span><span class="op">.</span><span class="ide">isAccessible</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">      <span class="com">## create directory uploaded if not exist</span></div></div><div class="line"><div class="line-content">      <span class="kwd">if</span> <span class="kwd">not</span> <span class="str">&quot;uploaded&quot;</span><span class="op">.</span><span class="ide">dirExists</span>:</div></div><div class="line"><div class="line-content">        <span class="str">&quot;uploaded&quot;</span><span class="op">.</span><span class="ide">createDir</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">      <span class="com">## check if files exists</span></div></div><div class="line"><div class="line-content">      <span class="kwd">if</span> <span class="str">&quot;onefile&quot;</span> <span class="kwd">in</span> <span class="op">@!</span><span class="ide">Form</span><span class="op">.</span><span class="ide">files</span>:</div></div><div class="line"><div class="line-content">        <span class="kwd">let</span> <span class="ide">onefile</span> <span class="op">=</span> <span class="op">@!</span><span class="ide">Form</span><span class="op">.</span><span class="ide">files</span>[<span class="str">&quot;onefile&quot;</span>][<span class="num">0</span>]</div></div><div class="line"><div class="line-content">        <span class="com">## move files to uploaded dir</span></div></div><div class="line"><div class="line-content">        <span class="ide">onefile</span><span class="op">.</span><span class="ide">path</span><span class="op">.</span><span class="ide">moveFile</span>(<span class="str">&quot;uploaded&quot;</span><span class="op">.</span><span class="ide">Path</span><span class="op">/</span><span class="ide">onefile</span><span class="op">.</span><span class="ide">Path</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">      <span class="kwd">if</span> <span class="str">&quot;multiplefiles&quot;</span> <span class="kwd">in</span> <span class="op">@!</span><span class="ide">Form</span><span class="op">.</span><span class="ide">files</span>:</div></div><div class="line"><div class="line-content">        <span class="kwd">let</span> <span class="ide">multiplefiles</span> <span class="op">=</span> <span class="op">@!</span><span class="ide">Form</span><span class="op">.</span><span class="ide">files</span>[<span class="str">&quot;multiplefiles&quot;</span>]</div></div><div class="line"><div class="line-content">        <span class="kwd">for</span> <span class="ide">file</span> <span class="kwd">in</span> <span class="ide">multiplefiles</span>:</div></div><div class="line"><div class="line-content">          <span class="com">## move files to uploaded dir</span></div></div><div class="line"><div class="line-content">          <span class="ide">file</span><span class="op">.</span><span class="ide">path</span><span class="op">.</span><span class="ide">moveFile</span>(<span class="str">&quot;uploaded&quot;</span><span class="op">/</span><span class="ide">file</span><span class="op">.</span><span class="ide">name</span><span class="op">.</span><span class="ide">Path</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">m</span> <span class="op">=</span> <span class="ide">newMustache</span>()</div></div><div class="line"><div class="line-content">    <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="ide">m</span><span class="op">.</span><span class="ide">render</span>(<span class="ide">tpl</span>))</div></div>  </code></pre>
<h3>8.6 Redirect</h3>
<p>We can modify response header for redirection purpose</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/home&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="str">&quot;&lt;h3&gt;Welcome home!&lt;/h3&gt;&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/test-redirect&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## modify response header add redirect location to /home</span></div></div><div class="line"><div class="line-content">    <span class="op">@!</span><span class="ide">Res</span><span class="op">.</span><span class="ide">headers</span>[<span class="str">&quot;Location&quot;</span>] <span class="op">=</span> <span class="str">&quot;/home&quot;</span></div></div><div class="line"><div class="line-content">    <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http307</span>, <span class="str">&quot;&quot;</span>)</div></div>  </code></pre>
<h3>8.7 Session</h3>
<p>See <em>katalis/core/session.nim</em></p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="com">## init cookie session</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Before</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">initCookieSession</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/hello&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">addCookieSession</span>(<span class="str">&quot;name&quot;</span>, <span class="op">%</span><span class="str">&quot;Tian Long&quot;</span>)</div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">name</span> <span class="op">=</span> <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">getCookieSession</span>(<span class="str">&quot;name&quot;</span>)</div></div><div class="line"><div class="line-content">    <span class="com">## remove individual session with @!Context.deleteCookieSession(&quot;name&quot;)</span></div></div><div class="line"><div class="line-content">    <span class="com">## destroy all session value with @!Context.destroyCookieSession()</span></div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="op">&amp;</span><span class="str">&quot;Hello {name}!&quot;</span>)</div></div>  </code></pre>
<h2>9. Before, After, OnReply, Cleanup Pipelines</h2>
<h3>9.1 Before pipeline</h3>
<p>Before pipeline will execute before routing process, also before serving staticfile. We can use it to check for all route before route process. We can skip all route by returning <em>true</em> statement</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Before</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## your code here</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="ide">something_wrong</span>:</div></div><div class="line"><div class="line-content">      <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http403</span>, <span class="str">&quot;Anauthorized access!&quot;</span>)</div></div><div class="line"><div class="line-content">      <span class="com">## by returning true, will skip all process and return the error message, this is simplify for checking</span></div></div><div class="line"><div class="line-content">      <span class="kwd">return</span> <span class="ide">true</span></div></div>  </code></pre>
<h3>9.2 After pipeline</h3>
<p>After pipeline will execute after routing process, also after serving staticfile</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">After</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## your code here</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="ide">something_wrong</span>:</div></div><div class="line"><div class="line-content">      <span class="op">@!</span><span class="ide">Res</span><span class="op">.</span><span class="ide">headers</span>[<span class="str">&quot;Location&quot;</span>] <span class="op">=</span> <span class="str">&quot;/home&quot;</span></div></div><div class="line"><div class="line-content">      <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http307</span>, <span class="str">&quot;&quot;</span>)</div></div><div class="line"><div class="line-content">      <span class="com">## return true for skip all routing definition</span></div></div><div class="line"><div class="line-content">      <span class="kwd">return</span> <span class="ide">true</span></div></div>  </code></pre>
<h3>9.3 OnReply</h3>
<p>OnReply pipeline will process before sending request to client, we can modify for all response from route. This example is from katalis/pipelines/onReply/httpChunked.nim, this code is for converting all response to chunked data before sending to client</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com">##</span></div></div><div class="line"><div class="line-content"><span class="com">## katalis framework</span></div></div><div class="line"><div class="line-content"><span class="com">## This framework if free to use and to modify</span></div></div><div class="line"><div class="line-content"><span class="com">## License: MIT</span></div></div><div class="line"><div class="line-content"><span class="com">## Author: Amru Rosyada</span></div></div><div class="line"><div class="line-content"><span class="com">## Email: amru.rosyada@gmail.com, amru.rosyada@amscloud.co.id</span></div></div><div class="line"><div class="line-content"><span class="com">## Git: https://github.com/zendbit/katalis</span></div></div><div class="line"><div class="line-content"><span class="com">##</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com">##</span></div></div><div class="line"><div class="line-content"><span class="com">## add pipeline onreply</span></div></div><div class="line"><div class="line-content"><span class="com">## as http protocol handler</span></div></div><div class="line"><div class="line-content"><span class="com">## check if chunked Transfer-Encoding enabled or not</span></div></div><div class="line"><div class="line-content"><span class="com">##</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">std</span><span class="op">/</span></div></div><div class="line"><div class="line-content">[</div></div><div class="line"><div class="line-content">  <span class="ide">streams</span>,</div></div><div class="line"><div class="line-content">  <span class="ide">strutils</span></div></div><div class="line"><div class="line-content">]</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">import</span></div></div><div class="line"><div class="line-content">  <span class="op">../../</span><span class="ide">core</span><span class="op">/</span><span class="ide">routes</span>,</div></div><div class="line"><div class="line-content">  <span class="op">../../</span><span class="ide">macros</span><span class="op">/</span><span class="ide">sugar</span>,</div></div><div class="line"><div class="line-content">  <span class="op">../../</span><span class="ide">core</span><span class="op">/</span><span class="ide">environment</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">composeChunkPayload</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">ctx</span>: <span class="ide">HttpContext</span>,</div></div><div class="line"><div class="line-content">    <span class="ide">env</span>: <span class="ide">Environment</span> <span class="op">=</span> <span class="ide">environment</span><span class="op">.</span><span class="ide">instance</span>()</div></div><div class="line"><div class="line-content">  ): <span class="ide">string</span> {<span class="op">.</span><span class="ide">gcsafe</span><span class="op">.</span>} <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="com">## compose chunk payload</span></div></div><div class="line"><div class="line-content">  <span class="com">## chunked transfer encoding must follow this role</span></div></div><div class="line"><div class="line-content">  <span class="com">## for more details see about Transfer-Encoding: chunked</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="ide">result</span> <span class="op">=</span> <span class="ide">ctx</span><span class="op">.</span><span class="ide">response</span><span class="op">.</span><span class="ide">body</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">bodyLength</span> <span class="op">=</span> <span class="ide">ctx</span><span class="op">.</span><span class="ide">response</span><span class="op">.</span><span class="ide">body</span><span class="op">.</span><span class="ide">len</span></div></div><div class="line"><div class="line-content">  <span class="kwd">var</span> <span class="ide">chunkSize</span> <span class="op">=</span> <span class="ide">env</span><span class="op">.</span><span class="ide">settings</span><span class="op">.</span><span class="ide">chunkSize</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="ide">env</span><span class="op">.</span><span class="ide">settings</span><span class="op">.</span><span class="ide">enableChunkedTransfer</span> <span class="kwd">and</span></div></div><div class="line"><div class="line-content">    <span class="ide">bodyLength</span> <span class="op">&gt;=</span> <span class="ide">chunkSize</span>:</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">proc</span> <span class="ide">constructChunk</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">chunkSize</span>: <span class="ide">string</span>,</div></div><div class="line"><div class="line-content">        <span class="ide">chunk</span>: <span class="ide">string</span></div></div><div class="line"><div class="line-content">      ): <span class="ide">string</span> <span class="op">=</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">      <span class="ide">result</span> <span class="op">=</span> <span class="ide">chunkSize</span> <span class="op">&amp;</span></div></div><div class="line"><div class="line-content">        <span class="op">$</span><span class="ide">CRLF</span> <span class="op">&amp;</span></div></div><div class="line"><div class="line-content">        <span class="ide">chunk</span> <span class="op">&amp;</span></div></div><div class="line"><div class="line-content">        <span class="op">$</span><span class="ide">CRLF</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">numberOfChunks</span> <span class="op">=</span> (<span class="ide">bodyLength</span> <span class="op">/</span> <span class="ide">chunkSize</span>)<span class="op">.</span><span class="ide">int</span></div></div><div class="line"><div class="line-content">    <span class="kwd">var</span> <span class="ide">chunkSizeInHex</span> <span class="op">=</span> <span class="ide">chunkSize</span><span class="op">.</span><span class="ide">toHex</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">bodyStream</span> <span class="op">=</span> <span class="ide">newStringStream</span>(<span class="ide">result</span>)</div></div><div class="line"><div class="line-content">    <span class="kwd">var</span> <span class="ide">bodyBuffer</span>: <span class="ide">string</span> <span class="op">=</span> <span class="str">&quot;&quot;</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">for</span> <span class="ide">_</span> <span class="kwd">in</span> <span class="num">1.</span><span class="op">.</span><span class="ide">numberOfChunks</span>:</div></div><div class="line"><div class="line-content">      <span class="ide">bodyBuffer</span> <span class="op">&amp;=</span> <span class="ide">constructChunk</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">chunkSizeInHex</span>,</div></div><div class="line"><div class="line-content">        <span class="ide">bodyStream</span><span class="op">.</span><span class="ide">readStr</span>(<span class="ide">chunkSize</span>)</div></div><div class="line"><div class="line-content">      )</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="ide">bodyLength</span> <span class="op">&gt;</span> <span class="ide">chunkSize</span>:</div></div><div class="line"><div class="line-content">      <span class="ide">chunkSize</span> <span class="op">=</span> <span class="ide">bodyLength</span> <span class="kwd">mod</span> <span class="ide">chunkSize</span></div></div><div class="line"><div class="line-content">      <span class="ide">bodyBuffer</span> <span class="op">&amp;=</span> <span class="ide">constructChunk</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">chunkSize</span><span class="op">.</span><span class="ide">toHex</span>,</div></div><div class="line"><div class="line-content">        <span class="ide">bodyStream</span><span class="op">.</span><span class="ide">readStr</span>(<span class="ide">chunkSize</span>)</div></div><div class="line"><div class="line-content">      )</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="ide">bodyBuffer</span> <span class="op">&amp;=</span> <span class="ide">constructChunk</span>(<span class="str">&quot;0&quot;</span>, <span class="str">&quot;&quot;</span>)</div></div><div class="line"><div class="line-content">    <span class="ide">bodyStream</span><span class="op">.</span><span class="ide">close</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="ide">result</span> <span class="op">=</span> <span class="ide">bodyBuffer</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">OnReply</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="op">@!</span><span class="ide">Req</span><span class="op">.</span><span class="ide">httpMethod</span> <span class="op">==</span> <span class="ide">HttpHead</span>: <span class="kwd">return</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="kwd">not</span> <span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">enableChunkedTransfer</span> <span class="kwd">or</span></div></div><div class="line"><div class="line-content">      <span class="op">@!</span><span class="ide">Res</span><span class="op">.</span><span class="ide">body</span><span class="op">.</span><span class="ide">len</span> <span class="op">&gt;</span> <span class="op">@!</span><span class="ide">Env</span><span class="op">.</span><span class="ide">settings</span><span class="op">.</span><span class="ide">chunkSize</span>:</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">      <span class="op">@!</span><span class="ide">Res</span><span class="op">.</span><span class="ide">body</span> <span class="op">=</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">composeChunkPayload</span>(<span class="op">@!</span><span class="ide">Env</span>)</div></div><div class="line"><div class="line-content">      <span class="op">@!</span><span class="ide">Res</span><span class="op">.</span><span class="ide">headers</span>[<span class="str">&quot;transfer-encoding&quot;</span>] <span class="op">=</span> <span class="str">&quot;chunked&quot;</span></div></div>  </code></pre>
<h3>9.4 Cleanup</h3>
<p>Cleanup pipeline will process after all pipeline finished, this usually for cleanup resource. This example is from katalis/pipelines/cleanup/httpContext.nim</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com">##</span></div></div><div class="line"><div class="line-content"><span class="com">## katalis framework</span></div></div><div class="line"><div class="line-content"><span class="com">## This framework if free to use and to modify</span></div></div><div class="line"><div class="line-content"><span class="com">## License: MIT</span></div></div><div class="line"><div class="line-content"><span class="com">## Author: Amru Rosyada</span></div></div><div class="line"><div class="line-content"><span class="com">## Email: amru.rosyada@gmail.com, amru.rosyada@amscloud.co.id</span></div></div><div class="line"><div class="line-content"><span class="com">## Git: https://github.com/zendbit/katalis</span></div></div><div class="line"><div class="line-content"><span class="com">##</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com">##</span></div></div><div class="line"><div class="line-content"><span class="com">## Cleanup body request cache</span></div></div><div class="line"><div class="line-content"><span class="com">##</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">import</span></div></div><div class="line"><div class="line-content">  <span class="op">../../</span><span class="ide">core</span><span class="op">/</span><span class="ide">routes</span>,</div></div><div class="line"><div class="line-content">  <span class="op">../../</span><span class="ide">macros</span><span class="op">/</span><span class="ide">sugar</span>,</div></div><div class="line"><div class="line-content">  <span class="op">../../</span><span class="ide">core</span><span class="op">/</span><span class="ide">environment</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Cleanup</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="op">@!</span><span class="ide">Req</span><span class="op">.</span><span class="ide">body</span><span class="op">.</span><span class="ide">fileExists</span>:</div></div><div class="line"><div class="line-content">      <span class="op">@!</span><span class="ide">Req</span><span class="op">.</span><span class="ide">body</span><span class="op">.</span><span class="ide">removeFile</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="op">@!</span><span class="ide">Req</span><span class="op">.</span><span class="ide">param</span><span class="op">.</span><span class="ide">form</span><span class="op">.</span><span class="ide">files</span><span class="op">.</span><span class="ide">len</span> <span class="op">!=</span> <span class="num">0</span>:</div></div><div class="line"><div class="line-content">      <span class="com">## remove file after file uploaded</span></div></div><div class="line"><div class="line-content">      <span class="com">## uploaded file should be move after finished</span></div></div><div class="line"><div class="line-content">      <span class="com">## file uploaded before cleanup present</span></div></div><div class="line"><div class="line-content">      <span class="kwd">for</span> <span class="ide">_</span>, <span class="ide">files</span> <span class="kwd">in</span> <span class="op">@!</span><span class="ide">Req</span><span class="op">.</span><span class="ide">param</span><span class="op">.</span><span class="ide">form</span><span class="op">.</span><span class="ide">files</span>:</div></div><div class="line"><div class="line-content">        <span class="kwd">for</span> <span class="ide">file</span> <span class="kwd">in</span> <span class="ide">files</span>:</div></div><div class="line"><div class="line-content">          <span class="kwd">if</span> <span class="kwd">not</span> <span class="ide">file</span><span class="op">.</span><span class="ide">isAccessible</span> <span class="kwd">or</span> <span class="kwd">not</span> <span class="ide">file</span><span class="op">.</span><span class="ide">path</span><span class="op">.</span><span class="ide">fileExists</span>:</div></div><div class="line"><div class="line-content">            <span class="kwd">continue</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">          <span class="ide">file</span><span class="op">.</span><span class="ide">path</span><span class="op">.</span><span class="ide">removeFile</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com">## clear http context</span></div></div><div class="line"><div class="line-content">    <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">clear</span></div></div>  </code></pre>
<h2>10. Response Message</h2>
<p>Response message is universal response message, using this response message will always response application/json. See <em>katalis/core/replyMsg</em></p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/test-replymsg&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## see core katalis/core/replyMsg.nim</span></div></div><div class="line"><div class="line-content">    <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">newReplyMsg</span>(</div></div><div class="line"><div class="line-content">      <span class="ide">httpCode</span> <span class="op">=</span> <span class="ide">Http200</span>,</div></div><div class="line"><div class="line-content">      <span class="ide">success</span> <span class="op">=</span> <span class="ide">true</span>,</div></div><div class="line"><div class="line-content">      <span class="ide">data</span> <span class="op">=</span> <span class="op">%*</span>{</div></div><div class="line"><div class="line-content">        <span class="str">&quot;username&quot;</span>: <span class="str">&quot;tian&quot;</span>,</div></div><div class="line"><div class="line-content">        <span class="str">&quot;address&quot;</span>: <span class="str">&quot;Guangdong&quot;</span></div></div><div class="line"><div class="line-content">      },</div></div><div class="line"><div class="line-content">      <span class="ide">error</span> <span class="op">=</span> <span class="op">%*</span>{}</div></div><div class="line"><div class="line-content">    ))</div></div>  </code></pre>
<h2>11. Validation</h2>
<p>Katalis comes with validations feature. See katalis/extension/validation.nim.</p>
<p>Available validations are:</p>
<ul>
<li>isRequired</li>
<li>isEmail</li>
<li>minValue</li>
<li>maxValue</li>
<li>minLength</li>
<li>maxLength</li>
<li>isDateTime</li>
<li>minDateTime</li>
<li>maxDateTime</li>
<li>inList</li>
<li>matchWith -&gt; regex validation</li>
</ul>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span>[<span class="ide">Get</span>, <span class="ide">Post</span>] <span class="str">&quot;/test-validation&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="com">## validation is extension on katalis</span></div></div><div class="line"><div class="line-content">    <span class="com">## see katalis/extension/validation.nim</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">tpl</span> <span class="op">=</span></div></div><div class="line"><div class="line-content">      """
        <html>
          <head><title>validation test</title></head>
          <body>
            <form method="POST">
              <label>Username<label> <span>{{username.msg}}</span>
              <br>
              <input type="text" name="username" value="{{username.value}}">
              <br>
              <br>
              <label>Password</label> <span>{{password.msg}}</span>
              <br>
              <input type="password" name="password" value="{{password.value}}">
              <br>
              <br>
              <input type="submit" value="Register">
            </form>
          </body>
        </html>
      """</div></div><div class="line"><div class="line-content">    </div></div><div class="line"><div class="line-content">    <span class="com">## mustache template</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">m</span> <span class="op">=</span> <span class="ide">newMustache</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="op">@!</span><span class="ide">Req</span><span class="op">.</span><span class="ide">httpMethod</span> <span class="op">==</span> <span class="ide">HttpPost</span>:</div></div><div class="line"><div class="line-content">      <span class="com">## parameter can be Form, JsonNode or Table[string, string] type</span></div></div><div class="line"><div class="line-content">      <span class="kwd">let</span> <span class="ide">v</span> <span class="op">=</span> <span class="ide">newValidation</span>(<span class="op">@!</span><span class="ide">Form</span>)</div></div><div class="line"><div class="line-content">      <span class="ide">v</span><span class="op">.</span><span class="ide">withField</span>(<span class="str">&quot;username&quot;</span>)<span class="op">.</span></div></div><div class="line"><div class="line-content">        <span class="ide">isRequired</span>(<span class="ide">failedMsg</span> <span class="op">=</span> <span class="str">&quot;Username is empty.&quot;</span>)<span class="op">.</span> <span class="com">## we can add custom failedMsg</span></div></div><div class="line"><div class="line-content">        <span class="ide">minLength</span>(<span class="num">8</span>)<span class="op">.</span> <span class="com">## minimum length of field value is 8 char length</span></div></div><div class="line"><div class="line-content">        <span class="ide">maxLength</span>(<span class="num">50</span>)<span class="op">.</span> <span class="com">## maximum length of field value is 50 char length</span></div></div><div class="line"><div class="line-content">        <span class="ide">matchWith</span>(<span class="str">&quot;([a-zA-Z0-9_]+)$&quot;</span>, <span class="ide">failedMsg</span> <span class="op">=</span> <span class="str">&quot;Only a-z A-Z 0-9 _ are allowed&quot;</span>) <span class="com">## check with regex, only allow a-z A-Z 0-9 _</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">      <span class="ide">v</span><span class="op">.</span><span class="ide">withField</span>(<span class="str">&quot;password&quot;</span>)<span class="op">.</span></div></div><div class="line"><div class="line-content">        <span class="ide">isRequired</span>(<span class="ide">failedMsg</span> <span class="op">=</span> <span class="str">&quot;Password is empty.&quot;</span>)<span class="op">.</span> <span class="com">## we can add custom failedMsg</span></div></div><div class="line"><div class="line-content">        <span class="ide">minLength</span>(<span class="num">8</span>)<span class="op">.</span> <span class="com">## minimum length 8 char length</span></div></div><div class="line"><div class="line-content">        <span class="ide">maxLength</span>(<span class="num">254</span>) <span class="com">## maximum length 254 char length</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">      <span class="com">## we can check validation result for each field</span></div></div><div class="line"><div class="line-content">      <span class="com">## lets print to console</span></div></div><div class="line"><div class="line-content">      <span class="ide">echo</span> <span class="str">&quot;username &quot;</span> <span class="op">&amp;</span> <span class="ide">v</span><span class="op">.</span><span class="ide">fields</span>[<span class="str">&quot;username&quot;</span>]<span class="op">.</span><span class="ide">msg</span> <span class="op">&amp;</span> <span class="str">&quot; -&gt; &quot;</span> <span class="op">&amp;</span> <span class="op">$</span><span class="ide">v</span><span class="op">.</span><span class="ide">fields</span>[<span class="str">&quot;username&quot;</span>]<span class="op">.</span><span class="ide">isValid</span></div></div><div class="line"><div class="line-content">      <span class="ide">echo</span> <span class="str">&quot;password &quot;</span> <span class="op">&amp;</span> <span class="ide">v</span><span class="op">.</span><span class="ide">fields</span>[<span class="str">&quot;password&quot;</span>]<span class="op">.</span><span class="ide">msg</span> <span class="op">&amp;</span> <span class="str">&quot; -&gt; &quot;</span> <span class="op">&amp;</span> <span class="op">$</span><span class="ide">v</span><span class="op">.</span><span class="ide">fields</span>[<span class="str">&quot;password&quot;</span>]<span class="op">.</span><span class="ide">isValid</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">      <span class="com">## set mustache context send data to template</span></div></div><div class="line"><div class="line-content">      <span class="kwd">for</span> <span class="ide">fieldName</span>, <span class="ide">fieldData</span> <span class="kwd">in</span> <span class="ide">v</span><span class="op">.</span><span class="ide">fields</span>:</div></div><div class="line"><div class="line-content">        <span class="ide">m</span><span class="op">.</span><span class="ide">context</span>[<span class="ide">fieldName</span>] <span class="op">=</span> <span class="op">%</span><span class="ide">fieldData</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="ide">m</span><span class="op">.</span><span class="ide">render</span>(<span class="ide">tpl</span>))</div></div>  </code></pre>
<h2>12. Template engine (Mustache)</h2>
<p>Nim come with <em>Mustache</em> template engine. see katalis/extension/mustache.nim, this template based on <a href="https://github.com/fenekku/moustachu">https://github.com/fenekku/moustachu</a>.</p>
<p>For using mustache, we need to import mustache from the extension</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">katalis</span><span class="op">/</span><span class="ide">extension</span><span class="op">/</span><span class="ide">mustache</span><span class="op">.</span><span class="ide">nim</span></div></div>  </code></pre>
<p>For mustache specs, you can refer to <a href="https://mustache.github.io/">https://mustache.github.io/</a></p>
<p>Mustache can be inline or using <em>.mustache</em> file, in this case we will setup mustache using <em>.mustache</em>.</p>
<p>We need create <em>templates</em> directory</p>
<pre>  <code class="language-bash">mkdir templates
</code></pre>
<p>Then add file <em>index.mustache, header.mustache, footer.mustache</em>. Mustache specs support partials template.</p>
<p>  <em>header.mustache</em></p>
<pre>  <code class="language-mustache">&lt;div&gt;
  &lt;h3&gt;This is header section&lt;h3&gt;
&lt;/div&gt;
</code></pre>
<p>  <em>footer.mustache</em></p>
<pre>  <code class="language-mustache">&lt;div&gt;
  &lt;h3&gt;This is footer section&lt;h3&gt;
&lt;/div&gt;
</code></pre>
<p>Then we will include partials <em>header.mustache and footer.mustache</em></p>
<p>  <em>index.mustache</em></p>
<pre>  <code class="language-mustache">&lt;html&gt;
  &lt;head&gt;&lt;title&gt;mustache example&lt;/title&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;div&gt;
      {{&gt; header}}
      &lt;div&gt;
        &lt;h3&gt;This is content section&lt;h3&gt;
        &lt;h3&gt;{{post.title}}&lt;/h3&gt;
        &lt;p&gt;{{post.article}}&lt;/p&gt;
      &lt;/div&gt;
      {{&gt; footer}}
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Mustache using <em>{{tag_mustache}}</em> for data binding, in current nim it support JsonNode, Tables, and mustache Context it self.</p>
<p>Let do with the code</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">Get</span> <span class="str">&quot;/test-mustache&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">m</span> <span class="op">=</span> <span class="ide">newMustache</span>()</div></div><div class="line"><div class="line-content">    <span class="ide">m</span><span class="op">.</span><span class="ide">context</span>[<span class="str">&quot;post&quot;</span>] <span class="op">=</span> <span class="op">%*</span>{<span class="str">&quot;title&quot;</span>: <span class="str">&quot;This is katalis&quot;</span>, <span class="str">&quot;article&quot;</span>: <span class="str">&quot;This is just simple micro framework but powerfull!&quot;</span>}</div></div><div class="line"><div class="line-content">    <span class="com">## call the index.mustache in the templates folder with m.render(&quot;index&quot;)</span></div></div><div class="line"><div class="line-content">    <span class="ide">await</span> <span class="op">@!</span><span class="ide">Context</span><span class="op">.</span><span class="ide">reply</span>(<span class="ide">Http200</span>, <span class="ide">m</span><span class="op">.</span><span class="ide">render</span>(<span class="str">&quot;index&quot;</span>))</div></div>  </code></pre>
<h2>13. Web Socket</h2>
<p>Out of the box with webscoket. See <em>katalis/core/webSocket.nim</em></p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">App</span>:</div></div><div class="line"><div class="line-content">  <span class="com">## it will accessed with ws://localhost:8000/ws</span></div></div><div class="line"><div class="line-content">  <span class="op">@!</span><span class="ide">WebSocket</span> <span class="str">&quot;/ws&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">case</span> <span class="op">@!</span><span class="ide">WebSocket</span><span class="op">.</span><span class="ide">state</span></div></div><div class="line"><div class="line-content">    <span class="kwd">of</span> <span class="ide">WsState</span><span class="op">.</span><span class="ide">Open</span>:</div></div><div class="line"><div class="line-content">      <span class="kwd">case</span> <span class="op">@!</span><span class="ide">WebSocket</span><span class="op">.</span><span class="ide">inFrame</span><span class="op">.</span><span class="ide">opCode</span></div></div><div class="line"><div class="line-content">      <span class="kwd">of</span> <span class="ide">WsOpCode</span><span class="op">.</span><span class="ide">TextFrame</span><span class="op">.</span><span class="ide">uint8</span>:</div></div><div class="line"><div class="line-content">        <span class="ide">await</span> <span class="op">@!</span><span class="ide">WebSocket</span><span class="op">.</span><span class="ide">reply</span>(<span class="str">&quot;This is from end point.&quot;</span>)</div></div><div class="line"><div class="line-content">      <span class="kwd">of</span> <span class="ide">WsOpCode</span><span class="op">.</span><span class="ide">ContinuationFrame</span><span class="op">.</span><span class="ide">uint8</span>:</div></div><div class="line"><div class="line-content">        <span class="com">## code here</span></div></div><div class="line"><div class="line-content">      <span class="kwd">of</span> <span class="ide">WsOpCode</span><span class="op">.</span><span class="ide">BinaryFrame</span><span class="op">.</span><span class="ide">uint8</span>:</div></div><div class="line"><div class="line-content">        <span class="com">## code here</span></div></div><div class="line"><div class="line-content">      <span class="kwd">else</span>:</div></div><div class="line"><div class="line-content">        <span class="kwd">discard</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">of</span> <span class="ide">WsState</span><span class="op">.</span><span class="ide">Close</span>:</div></div><div class="line"><div class="line-content">      <span class="ide">echo</span> <span class="str">&quot;Closed&quot;</span></div></div><div class="line"><div class="line-content">      </div></div><div class="line"><div class="line-content">    <span class="kwd">else</span>:</div></div><div class="line"><div class="line-content">      <span class="kwd">discard</span></div></div>  </code></pre>
<h2>14. Serve SSL</h2>
<p>Katalis also support serve SSL, we just need ssl certificate or we can use self signed certificate for development purpose.</p>
<p>Hot to create self signed SSL?, you can follow this instruction <a href="https://devcenter.heroku.com/articles/ssl-certificate-self">https://devcenter.heroku.com/articles/ssl-certificate-self</a>. Or you can find other resources from the internet world.</p>
<p>Then you can pass the certificate to the katalis settings</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@!</span><span class="ide">Settings</span><span class="op">.</span><span class="ide">sslSettings</span> <span class="op">=</span> <span class="ide">newSslSettings</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">certFile</span> <span class="op">=</span> <span class="str">&quot;path to certificate&quot;</span>,</div></div><div class="line"><div class="line-content">    <span class="ide">keyFile</span> <span class="op">=</span> <span class="str">&quot;path to key file&quot;</span>,</div></div><div class="line"><div class="line-content">    <span class="ide">port</span> <span class="op">=</span> <span class="ide">Port</span>(<span class="num">8443</span>), <span class="com">## default value</span></div></div><div class="line"><div class="line-content">    <span class="ide">enableVerify</span> <span class="op">=</span> <span class="ide">false</span> <span class="com">## set to true if using production and valid ssl certificate</span></div></div><div class="line"><div class="line-content">  )</div></div>  </code></pre>
<p>it will server on <a href="https://localhost:8443">https://localhost:8443</a></p>
<h2>15. Fullstack</h2>
<p>Katalis is not fullstack framework, but if you want to use katalis as part of your stack you can use with others framework.</p>
<p>Frontend:</p>
<ul>
<li>  <a href="https://htmx.org">htmx</a></li>
<li>  <a href="https://github.com/karaxnim/karax">karax</a></li>
<li>  <a href="https://github.com/enthus1ast/nimja">nimja</a></li>
</ul>
<p>Databse (ORM):</p>
<ul>
<li>  <a href="https://norm.nim.town/">norm</a></li>
<li>  <a href="https://norman.nim.town/">norman</a></li>
</ul>
<h2>16. Katalis Coding Style Guideline</h2>
<p>Katalis coding style guideline is simple</p>
<ul>
<li>Follow nim lang Coding Style</li>
<li>Only use Katalis DSL on the App and Pipeline don&apos;t use it on the <em>core, utils</em> to make katalis easy for debugging</li>
</ul>
</document>
            
        </div>
        <div class="col-3" id="meta-section">
            <div class="container box rounded p-3">
                
                    <p>
                        <strong>Licence:</strong>
                        MIT
                    </p>
                

                
                    <p> <a href="https://github.com/zendbit/katalis">Project website</a> </p>
                

                
            </div>
        </div>
    </div>
</div>
</div>

<footer class="pt-10 px-3">
  <div class="container pt-4">
    <div class="row mb-4">
      <div class="col-lg-3">
        <h4 class="h5">Getting started with Nim</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://learnxinyminutes.com/docs/nim/">Learn Nim in 5 minutes</a></li>
          <li><a class="text-decoration-none" href="https://nim-by-example.github.io/">Nim by Example</a></li>
          <li><a class="text-decoration-none" href="https://play.nim-lang.org/">Official Playground</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Official Tutorials</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut1.html">General Tutorial</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut2.html">Advanced Features</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut3.html">Macros and Metaprogramming</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Nim for...</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-C-programmers">C programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-Python-Programmers">Python programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-TypeScript-Programmers">TypeScript programmers</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Documentation</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/lib.html">Standard Library</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/manual.html">Language Manual</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tools.html">Tools Documentation</a></li>
        </ul>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 text-center mt-4 mx-auto">
        <a href="#" class="d-block mb-3 mx-auto bw"></a>
        <p class="text-muted">
        Created in <a href="https://nim-lang.org/">Nim</a> on <a href="https://pages.github.com/">GitHub Pages</a>.
        <a href="https://github.com/gabbhack/nimidirectory">Available</a>
        under <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License#Version_3">GPLv3</a>
        </p>
        <p class="text-muted">
        Builded at 2024-11-26T01:42:18Z
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
</script>
</body>
</html>
