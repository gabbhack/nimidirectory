<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nim Package Directory</title>
  <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="New and updated Nim packages" href="https://nimble.directory/packages.xml">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlite.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script type="text/javascript" src="/js/app.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container">
    <a href="/" class="logo fw-500 display-1 text-black text-decoration-none navbar-brand"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a href="https://nim-lang.org/" class="nav-link">What's Nim?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="/about.html" class="nav-link">What's Nimble?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="https://github.com/nim-lang/packages/" class="nav-link">Publish your package</a>
        </li>
        <!-- TODO: replace with something different -->
        <li class="nav-item ms-3">
          <a class="nav-link" href="https://www.youtube.com/channel/UCDAYn_VFt0VisL5-1a5Dk7Q/">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          </a>
        </li>
        <li class="nav-item ms-3">
          <a class="nav-link theme-switcher-btn" id="darkmode" onclick="toggle_dark_mode()" href="#">
            <span id="light-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </span>
            <span id="dark-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content">
  <div class="container">
    <div class="container pt-10">
        <h3 class="mb-3 fw-bold display-6 pt-4">computesim</h3>
        <p class="tags">
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">gpu-simulation</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">compute-shaders</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">gpgpu-computing</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">multithreading</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">parallelism</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">threads</button></a>
                </span>
            
        </p>
        
            <p class="pkg-desc">Learn and understand compute shader operations and control flow.</p>
        
        <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');"
            alt="Copy on clipboard">
            <i class="fa fa-copy"></i>
        </a>
        <input id="cmd" onclick="this.select();" value="nimble install computesim" readonly="">
        <br>
        <small style="font-size: 0.8rem;">Need help? Read <a
                href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small>
    </div>

    <div class="container row pt-4" id="pkg-content">
        <div class="col-8 box rounded p-3" id="readme-section">
            
                <document><h1>computesim</h1>
<p>A compute shader emulator for learning and debugging GPU compute shaders.</p>
<h2>Features</h2>
<ul>
<li>Emulates GPU compute shader execution on CPU</li>
<li>Simulates workgroups and subgroups with lockstep execution</li>
<li>Supports GLSL subgroup operations</li>
<li>Thread state visualization and debugging</li>
<li>Works with any Nim code that follows compute shader patterns</li>
</ul>
<h2>Example</h2>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># Compile with appropriate thread pool size and optimization settings</span></div></div><div class="line"><div class="line-content"><span class="com"># -d:ThreadPoolSize=MaxConcurrentWorkGroups*(ceilDiv(workgroupSize, SubgroupSize)+1)</span></div></div><div class="line"><div class="line-content"><span class="com"># -d:danger --threads:on --mm:arc</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">std</span><span class="op">/</span><span class="ide">math</span>, <span class="ide">computesim</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">type</span></div></div><div class="line"><div class="line-content">  <span class="ide">Buffers</span> <span class="op">=</span> <span class="kwd">object</span></div></div><div class="line"><div class="line-content">    <span class="ide">input</span>: <span class="ide">seq</span>[<span class="ide">int32</span>]</div></div><div class="line"><div class="line-content">    <span class="ide">atomicSum</span>: <span class="ide">int32</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">reduce</span>(<span class="ide">buffers</span>: <span class="kwd">ptr</span> <span class="ide">Buffers</span>; <span class="ide">numElements</span>: <span class="ide">uint32</span>) {<span class="op">.</span><span class="ide">computeShader</span><span class="op">.</span>} <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">gid</span> <span class="op">=</span> <span class="ide">gl_GlobalInvocationID</span><span class="op">.</span><span class="ide">x</span></div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">value</span> <span class="op">=</span> <span class="kwd">if</span> <span class="ide">gid</span> <span class="op">&lt;</span> <span class="ide">numElements</span>: <span class="ide">buffers</span><span class="op">.</span><span class="ide">input</span>[<span class="ide">gid</span>] <span class="kwd">else</span>: <span class="num">0</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com"># First reduce within subgroup using efficient subgroup operation</span></div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">sum</span> <span class="op">=</span> <span class="ide">subgroupAdd</span>(<span class="ide">value</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com"># Only one thread per subgroup needs to add to global sum</span></div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="ide">gl_SubgroupInvocationID</span> <span class="op">==</span> <span class="num">0</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">atomicAdd</span> <span class="ide">buffers</span><span class="op">.</span><span class="ide">atomicSum</span>, <span class="ide">sum</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">const</span></div></div><div class="line"><div class="line-content">  <span class="ide">NumElements</span> <span class="op">=</span> <span class="num">1024&apos;</span><span class="ide">u32</span></div></div><div class="line"><div class="line-content">  <span class="ide">WorkGroupSize</span> <span class="op">=</span> <span class="num">256&apos;</span><span class="ide">u32</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">main</span>() <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="com"># Set up compute dimensions</span></div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">numWorkGroups</span> <span class="op">=</span> <span class="ide">uvec3</span>(<span class="ide">ceilDiv</span>(<span class="ide">NumElements</span>, <span class="ide">WorkGroupSize</span>), <span class="num">1</span>, <span class="num">1</span>)</div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">workGroupSize</span> <span class="op">=</span> <span class="ide">uvec3</span>(<span class="ide">WorkGroupSize</span>, <span class="num">1</span>, <span class="num">1</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com"># Initialize buffers</span></div></div><div class="line"><div class="line-content">  <span class="kwd">var</span> <span class="ide">buffers</span> <span class="op">=</span> <span class="ide">Buffers</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">input</span>: <span class="ide">newSeq</span>[<span class="ide">int32</span>](<span class="ide">NumElements</span>),</div></div><div class="line"><div class="line-content">    <span class="ide">atomicSum</span>: <span class="num">0</span></div></div><div class="line"><div class="line-content">  )</div></div><div class="line"><div class="line-content">  <span class="kwd">for</span> <span class="ide">i</span> <span class="kwd">in</span> <span class="num">0.</span><span class="op">.&lt;</span><span class="ide">NumElements</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">buffers</span><span class="op">.</span><span class="ide">input</span>[<span class="ide">i</span>] <span class="op">=</span> <span class="ide">int32</span>(<span class="ide">i</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com"># Run reduction on CPU</span></div></div><div class="line"><div class="line-content">  <span class="ide">runComputeOnCpu</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">numWorkGroups</span> <span class="op">=</span> <span class="ide">numWorkGroups</span>,</div></div><div class="line"><div class="line-content">    <span class="ide">workGroupSize</span> <span class="op">=</span> <span class="ide">workGroupSize</span>,</div></div><div class="line"><div class="line-content">    <span class="ide">compute</span> <span class="op">=</span> <span class="ide">reduce</span>,</div></div><div class="line"><div class="line-content">    <span class="ide">ssbo</span> <span class="op">=</span> <span class="kwd">addr</span> <span class="ide">buffers</span>,</div></div><div class="line"><div class="line-content">    <span class="ide">args</span> <span class="op">=</span> <span class="ide">NumElements</span></div></div><div class="line"><div class="line-content">  )</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">result</span> <span class="op">=</span> <span class="ide">buffers</span><span class="op">.</span><span class="ide">atomicSum</span></div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">expected</span> <span class="op">=</span> <span class="ide">int32</span>(<span class="ide">NumElements</span> <span class="op">*</span> (<span class="ide">NumElements</span> <span class="op">-</span> <span class="num">1</span>)) <span class="kwd">div</span> <span class="num">2</span></div></div><div class="line"><div class="line-content">  <span class="ide">echo</span> <span class="str">&quot;Reduction result: &quot;</span>, <span class="ide">result</span>, <span class="str">&quot;, expected: &quot;</span>, <span class="ide">expected</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">main</span>()</div></div>  </code></pre>
<p>The example demonstrates:</p>
<ul>
<li>Using subgroup operations for efficient reduction</li>
<li>Automatic handling of divergent control flow</li>
<li>Atomic operations for cross-workgroup communication</li>
<li>Proper synchronization between threads</li>
</ul>
<h2>Installation</h2>
<pre>  <code>nimble install computesim
</code></pre>
<h2>Usage</h2>
<ol>
<li>
<p>Write your shader using the <code>computeShader</code> macro which:</p>
<ul>
<li>Transforms control flow for lockstep execution</li>
<li>Converts subgroup operations into commands</li>
<li>Handles thread synchronization</li>
</ul>
</li>
<li>
<p>Configure execution:</p>
<ul>
<li>Set up workgroup dimensions</li>
<li>Prepare data buffers and shared memory</li>
<li>Call <code>runComputeOnCpu</code> with your shader</li>
</ul>
</li>
</ol>
<p>See the examples directory for more patterns and use cases.</p>
<h2>Limitations</h2>
<ul>
<li>Single wavefront/subgroup size</li>
<li>Limited subset of GLSL/compute operations</li>
<li>Performance is not representative of real GPU execution</li>
</ul>
<blockquote>
<p>[!WARNING]</p>
<h3>Workgroup Scheduling</h3>
<p>While this emulator runs workgroups using CPU threads, real GPU compute shaders have no fairness guarantees between workgroups. This means your code might work correctly in this CPU emulator but fail on real GPU hardware where workgroups can execute in any order and with varying levels of parallelism. Do not rely on any assumptions about workgroup execution order or scheduling that might be true in this CPU emulator but not guaranteed on actual GPUs.</p>
<h3>Memory Barriers</h3>
<p>The emulator does not support GLSL memory barrier operations (memoryBarrier, memoryBarrierBuffer, memoryBarrierShared, groupMemoryBarrier, etc). When porting compute shaders, you must replace all memory barrier calls with <code>subgroupBarrier()</code>. Be aware that while this substitution works for testing in the emulator, real GPU hardware requires proper memory barriers for correct memory ordering and visibility.</p>
</blockquote>
<h2>Compile-time Defines</h2>
<h3>Thread Management</h3>
<ul>
<li><code>ThreadPoolSize</code> - Required. Must be at least <code>MaxConcurrentWorkGroups*(ceilDiv(workgroupSize, SubgroupSize)+1)</code></li>
<li><code>SubgroupSize</code> - Size of each subgroup/wavefront (default: 8)</li>
<li><code>MaxConcurrentWorkGroups</code> - Maximum concurrent workgroups (default: 2)</li>
</ul>
<h3>Debug Options</h3>
<p>With <code>-d:debugSubgroup</code>, these control which workgroup/subgroup to debug:</p>
<ul>
<li><code>debugWorkgroupX/Y/Z</code> - Workgroup coordinates to debug (default: 0)</li>
<li><code>debugSubgroupID</code> - Subgroup ID to debug (default: 0)</li>
</ul>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># Example: Configure thread pool and groups</span></div></div><div class="line"><div class="line-content"><span class="ide">nim</span> <span class="ide">c</span> <span class="op">-</span><span class="ide">d</span>:<span class="ide">ThreadPoolSize</span><span class="op">=</span><span class="num">8</span> <span class="op">-</span><span class="ide">d</span>:<span class="ide">SubgroupSize</span><span class="op">=</span><span class="num">4</span> <span class="ide">myshader</span><span class="op">.</span><span class="ide">nim</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Example: Enable debugging for specific group</span></div></div><div class="line"><div class="line-content"><span class="ide">nim</span> <span class="ide">c</span> <span class="op">-</span><span class="ide">d</span>:<span class="ide">debugSubgroup</span> <span class="op">-</span><span class="ide">d</span>:<span class="ide">debugWorkgroupX</span><span class="op">=</span><span class="num">1</span> <span class="ide">myshader</span><span class="op">.</span><span class="ide">nim</span></div></div>  </code></pre>
<h2>License</h2>
<p>MIT</p>
</document>
            
        </div>
        <div class="col-3" id="meta-section">
            <div class="container box rounded p-3">
                
                    <p>
                        <strong>Licence:</strong>
                        MIT
                    </p>
                

                
                    <p> <a href="https://github.com/planetis-m/compute-sim">Project website</a> </p>
                

                
            </div>
        </div>
    </div>
</div>
</div>

<footer class="pt-10 px-3">
  <div class="container pt-4">
    <div class="row mb-4">
      <div class="col-lg-3">
        <h4 class="h5">Getting started with Nim</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://learnxinyminutes.com/docs/nim/">Learn Nim in 5 minutes</a></li>
          <li><a class="text-decoration-none" href="https://nim-by-example.github.io/">Nim by Example</a></li>
          <li><a class="text-decoration-none" href="https://play.nim-lang.org/">Official Playground</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Official Tutorials</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut1.html">General Tutorial</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut2.html">Advanced Features</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut3.html">Macros and Metaprogramming</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Nim for...</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-C-programmers">C programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-Python-Programmers">Python programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-TypeScript-Programmers">TypeScript programmers</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Documentation</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/lib.html">Standard Library</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/manual.html">Language Manual</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tools.html">Tools Documentation</a></li>
        </ul>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 text-center mt-4 mx-auto">
        <a href="#" class="d-block mb-3 mx-auto bw"></a>
        <p class="text-muted">
        Created in <a href="https://nim-lang.org/">Nim</a> on <a href="https://pages.github.com/">GitHub Pages</a>.
        <a href="https://github.com/gabbhack/nimidirectory">Available</a>
        under <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License#Version_3">GPLv3</a>
        </p>
        <p class="text-muted">
        Builded at 2025-01-09T02:04:18Z
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
</script>
</body>
</html>
